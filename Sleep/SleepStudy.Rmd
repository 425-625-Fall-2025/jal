---
title: "Sleep Study"
date: "2025-09-04"
output: pdf_document
---

```{r, include=FALSE}
# Group members: Ashley Yen, Jake Todd, Lee-Ann Kao
```

# Introduction

A student in the Yale School of Medicine is planning a study to compare a promising new iPhone/iTouch App (called SomnoPose) to a customized medical device (called the Embletta) for monitoring sleeping position. She's not actually interested in sleep, but is studying eye health. Her long-term research plan is to explore whether pressure on the eyes (perhaps due to sleeping position) could be related to various aspects of eye health. For example, a patient who sleeps almost exclusively on his/her left side might be placing pressure on his/her left eye that is very different from the right eye. Although sleep position isn't a direct measurement of "pressure on the eye," she believes it might be a helpful indicator. The Embletta is considered to be the "gold standard" for the purpose of this study. However, the SomnoPose solution is far less expensive than the Embletta, and the iPhone/iTouch is less cumbersome to sleep with. This student agreed to conduct a pilot study before moving onto a formal study to compare these two devices.

In this report, we analyze the data from the pilot study to determine how well the SomnoPose data compare to the Embletta data, and whether a formal study is warranted.

# Analysis

```{r, include=FALSE}
# load libraries
library(dplyr)
library(ggplot2)
library(tidyverse)

# read in data
days <- dir("SleepData")

# initiate list of data frames
data_days <- list()

# loop through days to read in data
for (i in days) {
  files <- dir(file.path("SleepData", i),
               full.names = TRUE, pattern = "^[^R]")
  
  x <- read.table(files[1], as.is = TRUE, skip = 1, header = FALSE)
  names(x) <- "angle"
  
  y <- read.csv(files[2], as.is = TRUE)
  names(y)[2] <- "angle"
  
  day_list <- list(embletta = x, somno = y)
  names(day_list) <- c("embletta", "somno")
  
  data_days[[i]] <- day_list
}
```

## November 15

```{r, echo=FALSE}
temp_data <- data_days[[1]]

embletta <- temp_data[[1]]
embletta <- data.frame(embletta)

start <- as.POSIXct("2011-11-15 22:00:00")
end <- as.POSIXct("2011-11-16 08:00:00")
timestamps <- seq(start, end, by = 0.1)[1:nrow(embletta)]
embletta$Time_of_day <- timestamps
embletta <- na.omit(embletta)
colnames(embletta) <- c('angle', 'Time_of_day')

embletta_const <- embletta[embletta$angle < 50,]
embletta_const <- embletta_const[embletta_const$angle > -50,]
const1 <- median(embletta_const$angle)
embletta$old_angle <- embletta$angle
embletta$angle <- embletta$angle - const1

embletta <- embletta[embletta$angle < 180,]
embletta <- embletta[embletta$angle > -180,]

somnopose <- temp_data[[2]]

somnopose_const <- somnopose[somnopose$angle < 50,]
somnopose_const <- somnopose_const[somnopose_const$angle > -50,]
const2 <- median(somnopose_const$angle)
somnopose$old_angle <- somnopose$angle
somnopose$angle <- somnopose$angle - const2

somnopose <- somnopose[somnopose$angle < 180,]
somnopose <- somnopose[somnopose$angle > -180,]

for(i in 1:nrow(somnopose)){
  if(grepl("^23:", somnopose$Time_of_day[i])){
    somnopose$Time_of_day[i] <- paste0('2011-11-15 ', somnopose$Time_of_day[i])
  } else {
    somnopose$Time_of_day[i] <- paste0('2011-11-16 ', somnopose$Time_of_day[i])
  }
}

somnopose$Time_of_day <- as.POSIXct(somnopose$Time_of_day)
somnopose <- somnopose[somnopose$Time_of_day < '2011-11-16 08:00:00', ]

comb = dplyr::full_join(embletta, somnopose, by = "Time_of_day")
names(comb) <- c("Embletta", "Time_of_day", "Old_Embletta", "Timestamp", "Somno", "Inclination", "Date", "Old_Somno")

comb1 = comb %>% select(c('Old_Embletta', 'Time_of_day', 'Old_Somno')) %>%
  rename(Somno = Old_Somno, Embletta = Old_Embletta)
comb2 = comb %>% dplyr::select(c('Embletta', 'Time_of_day', 'Somno'))

long_comb1 <- comb1 %>%
  pivot_longer(cols = c(Embletta, Somno), 
               names_to = "Device", 
               values_to = "old_angle")
long_comb1 <- na.omit(data.frame(long_comb1))

long_comb2 <- comb %>%
  pivot_longer(cols = c(Embletta, Somno), 
               names_to = "Device", 
               values_to = "Angle")
long_comb2 <- na.omit(data.frame(long_comb2))

g1 = ggplot(long_comb1, aes(x = Time_of_day, y = old_angle, color = Device)) + 
  geom_line(na.rm = TRUE) + 
  labs(
    title = "Angle Over Time by Device 11/15",
    x = "Time",
    y = "Angle",
    color = "Device"  # Label for the legend
  ) +
  geom_abline(slope = 0, intercept = 0, linetype = "dashed", lwd = 1, color = 'black') +
  theme_minimal()
g1

g2 = ggplot(long_comb2, aes(x = Time_of_day, y = Angle, color = Device)) + 
  geom_line(na.rm = TRUE) + 
  labs(
    title = "Adjusted Angle Over Time by Device 11/15",
    x = "Time",
    y = "Angle",
    color = "Device"  # Label for the legend
  ) +
  geom_abline(slope = 0, intercept = 0, linetype = "dashed", lwd = 1, color = 'black') +
  theme_minimal()
g2
```

## November 17

```{r, echo=FALSE}
day_2 <- data_days[[2]]
day_2_embletta <- day_2$embletta
day_2_somno <- day_2$somno

# we don't know the timestamps for embletta, but we know it was recording 10 pm - 7 am
# create a vector that has a timestamp for 10 measurements every second
# then merge with the dataframe
start_time <- as.POSIXct("2011-11-17 22:00:00", tz = "UTC")
end_time <- as.POSIXct("2011-11-18 06:59:59.9", tz = "UTC")

time_sequence <- seq(from = start_time, to = end_time, by = .1)

day_2_embletta_df <- data.frame(
    timestamp = time_sequence,
    angle = day_2_embletta
)

day_2_embletta_df$Time_of_day <- format(day_2_embletta_df$timestamp, "%H:%M:%S", tz = "UTC")

day_2_somno$device <- "Somno"
day_2_embletta_df$device <- "Embletta"

day_2_somno$Time_of_day <- format(as.POSIXct(day_2_somno$Time_of_day, format = "%H:%M:%OS"), format = "%H:%M:%OS")

# Convert Time_of_day to POSIXct with the correct date
day_2_somno$Datetime <- as.POSIXct(day_2_somno$Time_of_day, format="%H:%M:%S")

# Assign dates manually based on a cutoff (e.g., midnight)
times <- hms::as_hms(day_2_somno$Time_of_day)

# If time is less than some threshold (e.g., 12:00), assign next day
day_2_somno$Datetime <- as.POSIXct(
  paste(ifelse(times < hms::as_hms("12:00:00"), "2011-11-18", "2011-11-17"), 
        day_2_somno$Time_of_day),
  format = "%Y-%m-%d %H:%M:%S",
  tz = "UTC"
)

cutoff_start <- as.POSIXct("2011-11-17 22:28:29", tz = "UTC")
cutoff_end <- as.POSIXct("2011-11-18 02:19:10", tz = "UTC")

cutoff_start_time <- hms::as_hms(cutoff_start)
cutoff_end_time <- hms::as_hms(cutoff_end)

day_2_embletta_df <- day_2_embletta_df %>%
  filter(
    {
      t <- hms::as_hms(timestamp)
      if(cutoff_end_time < cutoff_start_time){
        # Time window goes over midnight
        t >= cutoff_start_time | t <= cutoff_end_time
      } else {
        # Time window within the same day
        t >= cutoff_start_time & t <= cutoff_end_time
      }
    }
  )
day_2_somno <- day_2_somno %>%
  filter(Datetime >= cutoff_start & Datetime <= cutoff_end)

day_2_somno$Time_of_day <- day_2_somno$Datetime
day_2_embletta_df$Time_of_day <- day_2_embletta_df$timestamp

day_2_embletta_df <- day_2_embletta_df %>%
  filter(angle >= -180 & angle <= 180)

combined_data <- bind_rows(day_2_somno, day_2_embletta_df)

ggplot(combined_data, aes(x = Time_of_day, y = angle, color = device)) +
  geom_line(na.rm = TRUE) +
  labs(
    title = "Angle Over Time by Device 11/17",
    x = "Time",
    y = "Angle",
    color = "Device"  # Label for the legend
  ) +
  geom_abline(slope = 0, intercept = 0, linetype = "dashed", lwd = 1, color = 'black') +
  theme_minimal()

# remove gap and plot again
embletta_const <- combined_data[(combined_data$device == "Embletta" & 
                                  combined_data$angle < 50),]
embletta_const <- embletta_const[(embletta_const$device == "Embletta" &
                                    embletta_const$angle > -50),]
const1 <- median(na.omit(embletta_const$angle))

combined_data$new_angle <- NA

combined_data[combined_data$device == "Embletta",]$new_angle <- combined_data[combined_data$device == "Embletta",]$angle - const1

somnopose_const <- combined_data[(combined_data$device == "Somno" & 
                                  combined_data$angle < 50),]
somnopose_const <- somnopose_const[(somnopose_const$device == "Somno" & 
                                  somnopose_const$angle > -50),]
const2 <- median(somnopose_const$angle)
combined_data[combined_data$device == "Somno",]$new_angle <- combined_data[combined_data$device == "Somno",]$angle - const2

ggplot(combined_data, aes(x = Time_of_day, 
                         y = new_angle, 
                         color = device, 
                         group = device)) +
  geom_line(na.rm = TRUE) + 
  labs(
    title = "Adjusted Angle Over Time by Device 11/17",
    x = "Time",
    y = "Angle",
    color = "Device"
  ) +
  geom_abline(slope = 0, intercept = 0, linetype = "dashed", lwd = 1, color = 'black') + 
  theme_minimal()
```

## November 18

```{r, echo=FALSE}
# separate lists for each day
nov18 <- data_days[[3]]

# start and end times for November 18 Embletta data
emb_start_time <- as.POSIXct("2011-11-18 22:00:00.0", format = "%Y-%m-%d %H:%M:%OS", tz = "UTC")
emb_end_time <- as.POSIXct("2011-11-19 6:59:59.9", format = "%Y-%m-%d %H:%M:%OS", tz = "UTC")

# create vector of embletta times at 0.1 second intervals
date_vector_ms <- seq.POSIXt(emb_start_time, emb_end_time, units = "seconds", by = .1)

# format the times to only show hours, minutes, seconds, and milliseconds
time_vector_ms <- format(date_vector_ms, format = "%H:%M:%OS", tz = "UTC")

# add time_of_day and measurement columns to embletta data frame
nov18[[1]]$Time_of_day <- time_vector_ms

# format the times in the somno data frame to match the embletta data frame
nov18[[2]]$Time_of_day <- format(as.POSIXct(nov18[[2]]$Time_of_day, 
                                            format = "%H:%M:%OS", tz = "UTC"), 
                                 format = "%H:%M:%OS", tz = "UTC")

# match the start and end times of the somno and embletta data
nov18[[1]] <- nov18[[1]] %>%
  filter(Time_of_day >= "00:41:56.0" & Time_of_day <= "06:59:59.9" &
           angle <= 180 &
           angle >= -180)

nov18[[2]] <- nov18[[2]] %>%
  filter(Time_of_day >= "00:41:56.0" & Time_of_day <= "06:59:59.9" &
           angle <= 180 &
           angle >= -180)

# add device column to both data frames
nov18[[1]]$device <- rep("Embletta", nrow(nov18[[1]]))
nov18[[2]]$device <- rep("Somno", nrow(nov18[[2]]))

# combine the two data frames into one
merged_nov18 <- bind_rows(
  nov18[[1]] %>% select(Time_of_day, angle, device), 
  nov18[[2]] %>% select(Time_of_day, angle, device)
)
merged_nov18$Time_of_day <- as.POSIXct(merged_nov18$Time_of_day, format="%H:%M:%OS", tz = "UTC")

# plot the data
ggplot(merged_nov18, aes(x = Time_of_day, 
                         y = angle, 
                         color = device, 
                         group = device)) +
  geom_line(na.rm = TRUE) + 
  labs(
    title = "Angle Over Time by Device 11/18",
    x = "Time",
    y = "Angle",
    color = "Device"
  ) +
  geom_abline(slope = 0, intercept = 0, linetype = "dashed", lwd = 1, color = 'black') + 
  theme_minimal()

# remove gap and plot again
embletta_const <- merged_nov18[(merged_nov18$device == "Embletta" & 
                                  merged_nov18$angle < 50),]
embletta_const <- embletta_const[(embletta_const$device == "Embletta" &
                                    embletta_const$angle > -50),]
const1 <- median(na.omit(embletta_const$angle))

merged_nov18$new_angle <- NA

merged_nov18[merged_nov18$device == "Embletta",]$new_angle <- merged_nov18[merged_nov18$device == "Embletta",]$angle - const1

somnopose_const <- merged_nov18[(merged_nov18$device == "Somno" & 
                                  merged_nov18$angle < 50),]
somnopose_const <- somnopose_const[(somnopose_const$device == "Somno" & 
                                  somnopose_const$angle > -50),]
const2 <- median(somnopose_const$angle)
merged_nov18[merged_nov18$device == "Somno",]$new_angle <- merged_nov18[merged_nov18$device == "Somno",]$angle - const2

ggplot(merged_nov18, aes(x = Time_of_day, 
                         y = new_angle, 
                         color = device, 
                         group = device)) +
  geom_line(na.rm = TRUE) + 
  labs(
    title = "Adjusted Angle Over Time by Device 11/18",
    x = "Time",
    y = "Angle",
    color = "Device"
  ) +
  geom_abline(slope = 0, intercept = 0, linetype = "dashed", lwd = 1, color = 'black') + 
  theme_minimal()
```

## November 19

```{r, echo=FALSE}
temp_data <- data_days[[4]]

embletta <- temp_data[[1]]
embletta <- data.frame(embletta)

start <- as.POSIXct("2011-11-19 22:00:00")
end <- as.POSIXct("2011-11-20 07:00:00")
timestamps <- seq(start, end, by = 0.1)[1:nrow(embletta)]
embletta$Time_of_day <- timestamps

colnames(embletta) <- c('angle', 'Time_of_day')

embletta_const <- embletta[embletta$angle < 50,]
embletta_const <- embletta_const[embletta_const$angle > -50,]
const1 <- median(embletta_const$angle)
embletta$old_angle <- embletta$angle
embletta$angle <- embletta$angle - const1

embletta <- embletta[embletta$angle < 180,]
embletta <- embletta[embletta$angle > -180,]

somnopose <- temp_data[[2]]

somnopose_const <- somnopose[somnopose$angle < 50,]
somnopose_const <- somnopose_const[somnopose_const$angle > -50,]
const2 <- median(somnopose_const$angle)
somnopose$old_angle <- somnopose$angle
somnopose$angle <- somnopose$angle - const2

somnopose <- somnopose[somnopose$angle < 180,]
somnopose <- somnopose[somnopose$angle > -180,]

for(i in 1:nrow(somnopose)){
  if(grepl("^23:", somnopose$Time_of_day[i])){
    somnopose$Time_of_day[i] <- paste0('2011-11-19 ', somnopose$Time_of_day[i])
  } else {
    somnopose$Time_of_day[i] <- paste0('2011-11-20 ', somnopose$Time_of_day[i])
  }
}

somnopose$Time_of_day <- as.POSIXct(somnopose$Time_of_day)

comb = dplyr::full_join(embletta, somnopose, by = "Time_of_day")
names(comb) <- c("Embletta", "Time_of_day", "Old_Embletta", "Timestamp", "Somno", "Inclination", "Date", "Old_Somno")

comb1 = comb %>% select(c('Old_Embletta', 'Time_of_day', 'Old_Somno')) %>%
  rename(Somno = Old_Somno, Embletta = Old_Embletta)
comb2 = comb %>% dplyr::select(c('Embletta', 'Time_of_day', 'Somno'))

long_comb1 <- comb1 %>%
  pivot_longer(cols = c(Embletta, Somno), 
               names_to = "Device", 
               values_to = "old_angle")
long_comb1 <- na.omit(data.frame(long_comb1))

long_comb2 <- comb %>%
  pivot_longer(cols = c(Embletta, Somno), 
               names_to = "Device", 
               values_to = "Angle")
long_comb2 <- na.omit(data.frame(long_comb2))

g1 = ggplot(long_comb1, aes(x = Time_of_day, y = old_angle, color = Device)) + 
  geom_line(na.rm = TRUE) + 
  labs(
    title = "Angle Over Time by Device 11/19",
    x = "Time",
    y = "Angle",
    color = "Device"  # Label for the legend
  ) +
  geom_abline(slope = 0, intercept = 0, linetype = "dashed", lwd = 1, color = 'black') +
  theme_minimal()
g1

g2 = ggplot(long_comb2, aes(x = Time_of_day, y = Angle, color = Device)) + 
  geom_line(na.rm = TRUE) + 
  labs(
    title = "Adjusted Angle Over Time by Device 11/19",
    x = "Time",
    y = "Angle",
    color = "Device"  # Label for the legend
  ) +
  geom_abline(slope = 0, intercept = 0, linetype = "dashed", lwd = 1, color = 'black') +
  theme_minimal()
g2
```

## November 23

```{r, echo=FALSE}
nov23 <- data_days[[5]]

# start and time for November 23 Embletta data
emb_start_time <- as.POSIXct("2011-11-24 00:30:00.0", 
                             format = "%Y-%m-%d %H:%M:%OS", tz = "UTC")

# create vector of embletta times at 0.1 second intervals
date_vector_ms <- seq.POSIXt(emb_start_time, units = "seconds", 
                             by = .1, length.out = nrow(nov23[[1]]))

# format the times to only show hours, minutes, seconds, and milliseconds
time_vector_ms <- format(date_vector_ms, format = "%H:%M:%OS", tz = "UTC")

# add time_of_day and measurement columns to embletta data frame
nov23[[1]]$Time_of_day <- time_vector_ms

# format the times in the somno data frame to match the embletta data frame
nov23[[2]]$Time_of_day <- format(as.POSIXct(nov23[[2]]$Time_of_day, 
                                            format = "%H:%M:%OS", tz = "UTC"), 
                                 format = "%H:%M:%OS", tz = "UTC")

# flip the embletta data
nov23[[1]]$angle <- -nov23[[1]]$angle

# match the start and end times of the somno and embletta data
nov23[[1]] <- nov23[[1]] %>%
  filter(Time_of_day >= "00:32:00.0" & Time_of_day <= "07:32:51.0" &
           angle <= 180 &
           angle >= -180)

nov23[[2]] <- nov23[[2]] %>%
  filter(Time_of_day >= "00:32:00.0" & Time_of_day <= "07:32:51.0" &
           angle <= 180 &
           angle >= -180)

# add device column to both data frames
nov23[[1]]$device <- rep("Embletta", nrow(nov23[[1]]))
nov23[[2]]$device <- rep("Somno", nrow(nov23[[2]]))

# combine the two data frames into one
merged_nov23 <- bind_rows(
  nov23[[1]] %>% select(Time_of_day, angle, device), 
  nov23[[2]] %>% select(Time_of_day, angle, device)
)

merged_nov23$Time_of_day <- as.POSIXct(merged_nov23$Time_of_day, format="%H:%M:%OS", tz = "UTC")

# plot the data
ggplot(merged_nov23, aes(x = Time_of_day, 
                         y = angle, 
                         color = device, 
                         group = device)) +
  geom_line(na.rm = TRUE) + 
  labs(
    title = "Angle Over Time by Device 11/23",
    x = "Time",
    y = "Angle",
    color = "Device"
  ) +
  geom_abline(slope = 0, intercept = 0, linetype = "dashed", lwd = 1, color = 'black') +
  theme_minimal()

# remove gap and plot again
embletta_const <- merged_nov23[(merged_nov23$device == "Embletta" & 
                                  merged_nov23$angle < 50),]
embletta_const <- embletta_const[(embletta_const$device == "Embletta" &
                                    embletta_const$angle > -50),]
const1 <- median(na.omit(embletta_const$angle))

merged_nov23$new_angle <- NA

merged_nov23[merged_nov23$device == "Embletta",]$new_angle <- merged_nov23[merged_nov23$device == "Embletta",]$angle - const1

somnopose_const <- merged_nov23[(merged_nov23$device == "Somno" & 
                                  merged_nov23$angle < 50),]
somnopose_const <- somnopose_const[(somnopose_const$device == "Somno" & 
                                  somnopose_const$angle > -50),]
const2 <- median(somnopose_const$angle)
merged_nov23[merged_nov23$device == "Somno",]$new_angle <- merged_nov23[merged_nov23$device == "Somno",]$angle - const2

ggplot(merged_nov23, aes(x = Time_of_day, 
                         y = new_angle, 
                         color = device, 
                         group = device)) +
  geom_line(na.rm = TRUE) + 
  labs(
    title = "Adjusted Angle Over Time by Device 11/23",
    x = "Time",
    y = "Angle",
    color = "Device"
  ) +
  geom_abline(slope = 0, intercept = 0, linetype = "dashed", lwd = 1, color = 'black') + 
  theme_minimal()
```

## November 24

```{r, echo=FALSE}
day_6 <- data_days[[6]]
day_6_embletta <- day_6$embletta
day_6_somno <- day_6$somno

# we don't know the timestamps for embletta, but we know it was recording 10 pm - 7 am
# create a vector that has a timestamp for 10 measurements every second
# then merge with the dataframe
thresh = 100
start_index <- which(day_6_embletta$angle > thresh)[1]
start_index <- start_index + 3000
# Keep all rows from that index onward
day_6_embletta <- day_6_embletta[start_index:nrow(day_6_embletta), ]
start_time <- as.POSIXct("2011-11-24 00:38:19", tz = "UTC")
end_time <- as.POSIXct("2011-11-24 06:59:59", tz = "UTC")

time_sequence <- seq(from = start_time, to = end_time, by = .1)

time_sequence <- time_sequence[1:length(day_6_embletta)]
day_6_embletta_df <- data.frame(
    timestamp = time_sequence,
    angle = day_6_embletta
)

day_6_embletta_df$Time_of_day <- format(day_6_embletta_df$timestamp, "%H:%M:%S", tz = "UTC")

day_6_somno$device <- "Somno"
day_6_embletta_df$device <- "Embletta"

day_6_somno$Time_of_day <- format(as.POSIXct(day_6_somno$Time_of_day, format = "%H:%M:%OS"), format = "%H:%M:%OS")

# Convert Time_of_day to POSIXct with the correct date
day_6_somno$Datetime <- as.POSIXct(day_6_somno$Time_of_day, format="%H:%M:%S")

# Assign dates manually based on a cutoff (e.g., midnight)
times <- hms::as_hms(day_6_somno$Time_of_day)

# If time is less than some threshold (e.g., 12:00), assign next day
day_6_somno$Datetime <- as.POSIXct(
  paste(ifelse(times < hms::as_hms("12:00:00"), "2011-11-24", "2011-11-23"), 
        day_6_somno$Time_of_day),
  format = "%Y-%m-%d %H:%M:%S",
  tz = "UTC"
)

day_6_somno$Time_of_day <- day_6_somno$Datetime
day_6_embletta_df$Time_of_day <- day_6_embletta_df$timestamp

day_6_somno$angle <- day_6_somno$angle * -1

day_6_embletta_df <- day_6_embletta_df %>%
  filter(angle >= -180 & angle <= 180)

combined_data <- bind_rows(day_6_somno, day_6_embletta_df)

ggplot(combined_data, aes(x = Time_of_day, y = angle, color = device)) +
  geom_line(na.rm = TRUE) +
  labs(
    title = "Angle Over Time by Device 11/24",
    x = "Time",
    y = "Angle",
    color = "Device"  # Label for the legend
  ) +
  geom_abline(slope = 0, intercept = 0, linetype = "dashed", lwd = 1, color = 'black') +
  theme_minimal()

# remove gap and plot again
embletta_const <- combined_data[(combined_data$device == "Embletta" & 
                                  combined_data$angle < 50),]
embletta_const <- embletta_const[(embletta_const$device == "Embletta" &
                                    embletta_const$angle > -50),]
const1 <- median(na.omit(embletta_const$angle))

combined_data$new_angle <- NA

combined_data[combined_data$device == "Embletta",]$new_angle <- combined_data[combined_data$device == "Embletta",]$angle - const1

somnopose_const <- combined_data[(combined_data$device == "Somno" & 
                                  combined_data$angle < 50),]
somnopose_const <- somnopose_const[(somnopose_const$device == "Somno" & 
                                  somnopose_const$angle > -50),]
const2 <- median(somnopose_const$angle)
combined_data[combined_data$device == "Somno",]$new_angle <- combined_data[combined_data$device == "Somno",]$angle - const2

ggplot(combined_data, aes(x = Time_of_day, 
                         y = new_angle, 
                         color = device, 
                         group = device)) +
  geom_line(na.rm = TRUE) + 
  labs(
    title = "Adjusted Angle Over Time by Device 11/24",
    x = "Time",
    y = "Angle",
    color = "Device"
  ) +
  geom_abline(slope = 0, intercept = 0, linetype = "dashed", lwd = 1, color = 'black') + 
  theme_minimal()
```


# Conclusion

Based on the analysis of the pilot study data, the SomnoPose data shows a reasonable level of agreement with the Embletta data, particularly in terms of overall trends and changes in sleeping position. However, a more formal study could be used to align/calibrate both devices so that laying on the back is the same 0 degree angle. Additionally, a more formal study would hopefully make start and stop times more standardized with consistent time recording.
