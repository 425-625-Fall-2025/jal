---
title: "CaseStudy3"
output: html_document
date: "2025-09-09"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(readxl)
library(dplyr)
library(tidyverse)
```

```{r}
sale_data <- read_excel("sales_data.xlsx")
hamden_data <- read_csv("hamden_data_complete.csv")
```
assessed = 0.7 * appraised

```{r}
sale_data = sale_data %>% filter(Description == 'Single Fam M01')
```

```{r}
for(i in 1:nrow(hamden_data)){
  hamden_data$PID[i] <- str_split(hamden_data$link[i],"-")[[1]][2]
}
hamden_data$PID <- as.numeric(hamden_data$PID)
```

```{r}
library(rvest)

for(i in 1:nrow(hamden_data)){
  temp_html <- read_html(paste0('/Users/ashle/Downloads/Hamden_Sept2025/',hamden_data$PID[i],'.html'))
  tables <- temp_html %>% 
    html_elements("table") %>%   
    html_table(fill = TRUE)
  sale_table <- tables[[5]]
  sale_table <- sale_table[!sale_table$X1 == "", ] 
  sale_table = sale_table %>% pivot_wider(names_from = X1, values_from = X2)
  hamden_data$Sale.Date[i] <- sale_table$`Sale Date`[1]
  hamden_data$Sale.Price[i] <- sale_table$`Sale Price`[1]
}
```


```{r}
diff_pct <- (sale_data$`Current Year Appraisal` - sale_data$`Sale Price`)/sale_data$`Sale Price`
mean(diff_pct)

```
log transform -- coefficient on year

```{r}
sale_data$Location <- paste(sale_data$`Property Number`, sale_data$`Street Name`)
```
```{r}
sale_data$Location[-c(which(sale_data$Location %in% data_hamden$Location))]
sale_data[c(which(sale_data$Location %in% data_hamden$Location)),]
```

```{r}
merged <- left_join(data_hamden, sale_data, by = 'PID')
```

```{r}
merge_sale <- subset(merged, !is.na(merged$`Sale Price`))
m1 <- lm(Sale.Price ~ )
```

